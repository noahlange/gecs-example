import{P as x,p as d,a as l,S as I,C as E,E as L,b as _}from"./vendor.af260859.js";function C(s){return Math.round(s*100)/100}function f(s,t){return Math.random()*(t-s)+s}const M=100;class R extends x{constructor(){super(...arguments);this.$={systems:[d(l.PRE_LOAD,()=>{this.ts=performance.now(),this.stats.begin()}),d(l.POST_RENDER,()=>{if(this.stats.end(),this.ms.ticks.push(performance.now()-this.ts),!(this.ms.ticks.length%M)){const t=C(this.ms.ticks.reduce((o,i)=>o+i,0)/M);this.ms.averages.push(t),this.ms.ticks=[],console.log(t);const e=this.ms.averages;e.length%10||console.log("rolling average",C(e.reduce((o,i)=>o+i,0)/e.length))}})]},this.stats=new I,this.ts=0,this.ms={averages:[],ticks:[]}}start(){document.body.appendChild(this.stats.dom)}}R.type="stats";class W extends x{constructor(){super(...arguments);this.ts=0,this.tick=async()=>{const t=performance.now();await this.ctx.tick(t-this.ts,t),this.ts=t,requestAnimationFrame(this.tick)}}}W.type="ticker";function H(s,t){const[e,o]=s.position,[i,h]=t.position,a=i-e,r=h-o,n=Math.sqrt(r*r+a*a);if(n>s.radius+t.radius||n<Math.abs(s.radius-t.radius))return null;const c=(s.radius*s.radius-t.radius*t.radius+n*n)/(2*n),p=e+a*c/n,y=o+r*c/n,P=Math.sqrt(s.radius*s.radius-c*c),T=-r*(P/n),$=a*(P/n);return[[p+T,y+$],[p-T,y-$]]}function g(s,[t,e],o){s.beginPath(),s.arc(t,e,o,0,Math.PI*2,!1),s.fill()}function N(s,[t,e],[o,i]){s.beginPath(),s.moveTo(t,e),s.lineTo(o,i),s.stroke()}function O(s){let t=1;const e=Array.from(s.$.circle.query.circles);for(const o of e){o.$.intersect.points=[];for(let i=t;i<e.length;i++){const h=H(o.$.circle,e[i].$.circle);h&&o.$.intersect.points.push(h)}t++}}function D(s,t){const e=s.$.circle.state;for(const o of s.$.circle.query.movers){const{circle:i,movement:h}=o.$;let[a,r]=i.position,[n,c]=h.acceleration,[p,y]=h.velocity;a=a+p*n*t*e.speed,r=r+y*c*t*e.speed,n=Math.max(1,n>1?n-t*e.speed:n),c=Math.max(1,c>1?c-t*e.speed:c),r=r+i.radius<0?e.height+i.radius:r,r=r-i.radius>e.height?-i.radius:r,a=a-i.radius>e.width?0:a,a=i.position[0]+i.radius<0?e.width:a,h.acceleration=[n,c],i.position=[a,r]}}var u;(function(s){s.WHITE="#ffffff",s.BLACK="#000000",s.YELLOW="#ffff99",s.WHITE_TRANS="#ffffff33"})(u||(u={}));function K(s){const{ctx:t,...e}=s.$.circle.state;(e.width!==e.canvas.width||e.height!==e.canvas.height)&&(e.canvas.width=e.width,e.canvas.height=e.height),t.fillStyle=u.BLACK,t.fillRect(0,0,e.width,e.height);for(const o of s.$.circle.query.circles){const{circle:i,intersect:h}=o.$,[a,r]=i.position;t.beginPath(),t.arc(a,r,i.radius,0,2*Math.PI,!1),t.lineWidth=1,t.strokeStyle=u.WHITE,t.stroke();for(const[n,c]of h.points)t.lineWidth=2,t.strokeStyle=u.YELLOW,t.fillStyle=u.WHITE_TRANS,g(t,n,8),g(t,c,8),t.fillStyle=u.WHITE,g(t,n,3),g(t,c,3),N(t,n,c)}}class w extends E{constructor(){super(...arguments);this.velocity=[0,0],this.acceleration=[0,0]}}w.type="movement";class m extends E{constructor(){super(...arguments);this.position=[0,0],this.radius=0}}m.type="circle";class v extends E{constructor(){super(...arguments);this.points=[]}}v.type="intersect";const b=L.with(m,w,v),S=class extends x{constructor(){super(...arguments);this.state={canvas:S.canvas,ctx:S.canvas.getContext("2d"),width:window.innerWidth,height:window.innerHeight,speed:.0025},this.query={circles:this.ctx.query.components(m,v),movers:this.ctx.query.components(m,w)},this.$={components:[m,v,w],entities:[b],systems:[d(l.ON_UPDATE,D),d(l.ON_RENDER,K),d(l.POST_RENDER,O)]}}start(){for(let s=0;s<30;s++)this.ctx.create(b,{circle:{position:[f(0,this.state.width),f(0,this.state.height)],radius:f(20,100)},movement:{velocity:[f(-20,20),f(-20,20)]}});window.addEventListener("resize",()=>{this.state.width=window.innerWidth,this.state.height=window.innerHeight})}};let k=S;k.type="circle",k.canvas=document.querySelector("canvas");const A=_.with(R,k,W),q=new A;q.start().then(()=>{q.$.ticker.tick()});
