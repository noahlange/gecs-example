import{P as x,p as l,a as f,S as b,C as w,E as L,b as _}from"./vendor.bbaf1434.js";function k(s){return Math.round(s*100)/100}function y(s,t){return Math.random()*(t-s)+s}const P=100;class $ extends x{constructor(){super(...arguments);this.$={systems:[l(f.PRE_LOAD,()=>{this.ts=performance.now(),this.stats.begin()}),l(f.POST_RENDER,()=>{if(this.stats.end(),this.ms.ticks.push(performance.now()-this.ts),!(this.ms.ticks.length%P)){const t=k(this.ms.ticks.reduce((n,i)=>n+i,0)/P);this.ms.averages.push(t),this.ms.ticks=[],console.log(t);const e=this.ms.averages;e.length%10||console.log("rolling average",k(e.reduce((n,i)=>n+i,0)/e.length))}})]},this.stats=new b,this.ts=0,this.ms={averages:[],ticks:[]}}start(){document.body.appendChild(this.stats.dom)}}$.type="stats";class p extends w{constructor(){super(...arguments);this.velocity={x:0,y:0},this.acceleration={x:0,y:0}}}p.type="movement";class u extends w{constructor(){super(...arguments);this.position={x:0,y:0},this.radius=0}}u.type="circle";class m extends w{constructor(){super(...arguments);this.points=[]}}m.type="intersect";function H(s,t){const e=t.position.x-s.position.x,n=t.position.y-s.position.y,i=Math.sqrt(n*n+e*e);if(i>s.radius+t.radius||i<Math.abs(s.radius-t.radius))return null;const r=(s.radius*s.radius-t.radius*t.radius+i*i)/(2*i),a=s.position.x+e*r/i,o=s.position.y+n*r/i,c=Math.sqrt(s.radius*s.radius-r*r),h=-n*(c/i),S=e*(c/i);return[{x:a+h,y:o+S},{x:a-h,y:o-S}]}function g(s,t,e){s.beginPath(),s.arc(t.x,t.y,e,0,Math.PI*2,!1),s.fill()}function N(s,t,e){s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(e.x,e.y),s.stroke()}let T;function O(s){T??={entities:s.$.components(u,m)};let t=1;const e=Array.from(T.entities);for(const n of e){n.$.intersect.points=[];for(let i=t;i<e.length;i++){const r=H(n.$.circle,e[i].$.circle);r&&n.$.intersect.points.push(r)}t++}}let C;function D(s,t){C??={entities:s.$.components(u,p)};const e=s.game.circle.state;for(const n of C.entities){const{circle:i,movement:r}=n.$;let{x:a,y:o}=i.position,{x:c,y:h}=r.acceleration;a=a+r.velocity.x*c*t*e.speed,o=o+r.velocity.y*h*t*e.speed,c=Math.max(1,c>1?c-t*e.speed:c),h=Math.max(1,h>1?h-t*e.speed:h),o=o+i.radius<0?e.height+i.radius:o,o=o-i.radius>e.height?-i.radius:o,a=a-i.radius>e.width?0:a,a=i.position.x+i.radius<0?e.width:a,r.acceleration={x:c,y:h},i.position={x:a,y:o}}}var d;(function(s){s.WHITE="#ffffff",s.BLACK="#000000",s.YELLOW="#ffff99",s.WHITE_TRANS="#ffffff33"})(d||(d={}));let M;function q(s){M??={circles:s.$.components(u,m)};const{ctx:t,...e}=s.game.circle.state;(e.width!==e.canvas.width||e.height!==e.canvas.height)&&(e.canvas.width=e.width,e.canvas.height=e.height),t.fillStyle=d.BLACK,t.fillRect(0,0,e.width,e.height);for(const n of M.circles){const{circle:i,intersect:r}=n.$;t.beginPath(),t.arc(i.position.x,i.position.y,i.radius,0,2*Math.PI,!1),t.lineWidth=1,t.strokeStyle=d.WHITE,t.stroke();for(const[a,o]of r.points)t.lineWidth=2,t.strokeStyle=d.YELLOW,t.fillStyle=d.WHITE_TRANS,g(t,a,8),g(t,o,8),t.fillStyle=d.WHITE,g(t,a,3),g(t,o,3),N(t,a,o)}}const R=L.with(u,p,m),v=class extends x{constructor(){super(...arguments);this.state={canvas:v.canvas,ctx:v.canvas.getContext("2d"),width:window.innerWidth,height:window.innerHeight,speed:.0025},this.$={components:[u,m,p],entities:[R],systems:[l(f.ON_UPDATE,D),l(f.ON_RENDER,q),l(f.POST_RENDER,O)]}}start(){for(let s=0;s<30;s++)this.ctx.create(R,{circle:{position:{x:y(0,this.state.width),y:y(0,this.state.height)},radius:y(20,100)},movement:{velocity:{x:y(-20,20),y:y(-20,20)}}});window.addEventListener("resize",()=>{this.state.width=window.innerWidth,this.state.height=window.innerHeight})}};let E=v;E.type="circle",E.canvas=document.querySelector("canvas");class W extends x{constructor(){super(...arguments);this.ts=0,this.tick=async()=>{const t=performance.now();await this.ctx.tick(t-this.ts,t),this.ts=t,requestAnimationFrame(this.tick)}}}W.type="ticker";const K=_.with($,E,W),I=new K;I.start().then(()=>{I.game.ticker.tick()});
