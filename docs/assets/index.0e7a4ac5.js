import{S as W,E as H,C as m,a as L}from"./vendor.697e5b91.js";function S(t){return Math.round(t*100)/100}function d(t,e){return Math.random()*(e-t)+t}function R(t,e){const s=e.position.x-t.position.x,i=e.position.y-t.position.y,n=Math.sqrt(i*i+s*s);if(n>t.radius+e.radius||n<Math.abs(t.radius-e.radius))return null;const o=(t.radius*t.radius-e.radius*e.radius+n*n)/(2*n),a=t.position.x+s*o/n,r=t.position.y+i*o/n,c=Math.sqrt(t.radius*t.radius-o*o),v=-i*(c/n),x=s*(c/n);return[{x:a+v,y:r+x},{x:a-v,y:r-x}]}function l(t,e,s){t.beginPath(),t.arc(e.x,e.y,s,0,Math.PI*2,!1),t.fill()}function T(t,e,s){t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(s.x,s.y),t.stroke()}let $;function j(t){$??={entities:t.$.components(h,u)};let e=0;const s=Array.from($.entities);for(const i of s){i.$.intersect.points=[];for(let n=e;n<s.length;n++){const o=R(i.$.circle,s[n].$.circle);o&&i.$.intersect.points.push(o)}}}let M;function z(t,e){M??={entities:t.$.components(h,p)};for(const s of M.entities){const{circle:i,movement:n}=s.$;let{x:o,y:a}=i.position,{x:r,y:c}=n.acceleration;o=o+n.velocity.x*r*e*t.state.speed,a=a+n.velocity.y*c*e*t.state.speed,r=Math.max(1,r>1?r-e*t.state.speed:r),c=Math.max(1,c>1?c-e*t.state.speed:c),a=a+i.radius<0?t.state.height+i.radius:a,a=a-i.radius>t.state.height?-i.radius:a,o=o-i.radius>t.state.width?0:o,o=i.position.x+i.radius<0?t.state.width:o,n.acceleration={x:r,y:c},i.position={x:o,y:a}}}let C;function F(t){C??={circles:t.$.components(h,u)};const{ctx:e,...s}=t.state;(s.width!==s.canvas.width||s.height!==s.canvas.height)&&(s.canvas.width=s.width,s.canvas.height=s.height),e.fillStyle="black",e.fillRect(0,0,s.width,s.height);for(const i of C.circles){const{circle:n,intersect:o}=i.$;e.beginPath(),e.arc(n.position.x,n.position.y,n.radius,0,2*Math.PI,!1),e.lineWidth=1,e.strokeStyle="#fff",e.stroke();for(const[a,r]of o.points)e.lineWidth=2,e.strokeStyle="#ff9",e.fillStyle="rgba(255, 255,255, 0.2)",l(e,a,8),l(e,r,8),e.fillStyle="#fff",l(e,a,3),l(e,r,3),T(e,a,r)}}const g=new W;document.body.appendChild(g.dom);const y=[],b=100;let k=0,f=[];const _=()=>{k=performance.now(),g.begin()},D=()=>{if(f.push(performance.now()-k),!(f.length%b)){const t=S(f.reduce((e,s)=>e+s,0)/b);y.push(t),console.log(t),f=[],y.length%10||console.log("rolling average",S(y.reduce((e,s)=>e+s,0)/y.length))}g.end()};class p extends m{constructor(){super(...arguments);this.velocity={x:0,y:0},this.acceleration={x:0,y:0}}}p.type="movement";class h extends m{constructor(){super(...arguments);this.position={x:0,y:0},this.radius=0}}h.type="circle";class u extends m{constructor(){super(...arguments);this.points=[]}}u.type="intersect";const G=H.with(h,p,u),w=class extends L.with(_,z,F,j,D){constructor(){super(...arguments);this.state={canvas:w.canvas,ctx:w.canvas.getContext("2d"),width:window.innerWidth,height:window.innerHeight,speed:.001}}start(){this.register({Circle:h,Intersecting:u,Movement:p});for(let t=0;t<30;t++)this.create(G,{circle:{position:{x:d(0,this.state.width),y:d(0,this.state.height)},radius:d(20,100)},movement:{velocity:{x:d(-20,20),y:d(-20,20)}}});return window.addEventListener("resize",()=>{this.state.width=window.innerWidth,this.state.height=window.innerHeight}),super.start()}};let E=w;E.canvas=document.querySelector("canvas");const P=new E;let q=performance.now();const I=async()=>{const t=performance.now();await P.tick(t-q,t),q=t,requestAnimationFrame(I)};P.start().then(I).catch(t=>console.error(t));
